<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Pricer Pro - Multi-Strat√©gies</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-toggle-btn" onclick="toggleTheme()">
            <span id="theme-icon">üåô</span>
            <span id="theme-text">Mode Clair</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìä Options Pricer Pro</h1>
                <p class="subtitle">Multi-Strat√©gies ‚Ä¢ Monte Carlo ‚Ä¢ Backtesting ‚Ä¢ Black-Scholes</p>
            </div>
            <div class="header-nav">
                <button onclick="showTab('basic')" class="nav-btn active" id="tab-basic">Analyse de Base</button>
                <button onclick="showTab('advanced')" class="nav-btn" id="tab-advanced">Analyses Avanc√©es</button>
                <button onclick="showTab('compare')" class="nav-btn" id="tab-compare">Comparaison</button>
                <button onclick="showTab('monte-carlo')" class="nav-btn" id="tab-monte-carlo">Monte Carlo</button>
                <button onclick="showTab('backtest')" class="nav-btn" id="tab-backtest">Backtesting</button>
                <button onclick="showTab('education')" class="nav-btn" id="tab-education">üìö √âducation</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="content">
            <!-- Input Section -->
            <div class="card input-section">
                <h2>üéØ Param√®tres du Straddle</h2>
                
                <div class="form-group">
                    <label for="ticker">Ticker du sous-jacent</label>
                    <div class="input-with-button">
                        <input type="text" id="ticker" placeholder="Ex: AAPL, MSFT, TSLA..." autocomplete="off">
                        <button onclick="validateTicker()" class="btn-primary">Valider</button>
                    </div>
                    <div id="ticker-feedback"></div>
                </div>

                <!-- Ticker Info (hidden by default) -->
                <div id="ticker-info" class="ticker-info" style="display: none;">
                    <div class="ticker-header">
                        <h3 id="ticker-name"></h3>
                        <span id="ticker-symbol" class="ticker-symbol"></span>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Prix actuel</span>
                            <span id="current-price" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Variation</span>
                            <span id="day-change" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Capitalisation</span>
                            <span id="market-cap" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Volume</span>
                            <span id="volume" class="info-value"></span>
                        </div>
                    </div>
                </div>

                <!-- Straddle Parameters -->
                <div id="straddle-params" style="display: none;">
                    <div class="form-group">
                        <label for="days">Jours jusqu'√† √©ch√©ance</label>
                        <input type="number" id="days" value="30" min="1" max="365">
                    </div>

                    <div class="form-group">
                        <label for="strike">Strike (laissez vide pour ATM)</label>
                        <input type="number" id="strike" placeholder="Optionnel - ATM par d√©faut" step="0.01">
                    </div>

                    <button onclick="calculateStraddle()" class="btn-calculate">
                        üî¢ Calculer le Straddle
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results-section" style="display: none;">
                <!-- Summary Card -->
                <div class="card results-card">
                    <h2>üìä R√©sultats du Pricing</h2>
                    
                    <div class="pricing-summary">
                        <div class="price-box">
                            <span class="price-label">Call Premium</span>
                            <span id="call-price" class="price-value">-</span>
                        </div>
                        <div class="price-box">
                            <span class="price-label">Put Premium</span>
                            <span id="put-price" class="price-value">-</span>
                        </div>
                        <div class="price-box total">
                            <span class="price-label">Co√ªt Total</span>
                            <span id="total-cost" class="price-value">-</span>
                        </div>
                    </div>

                    <div class="info-grid risk-metrics">
                        <div class="info-item">
                            <span class="info-label">Strike</span>
                            <span id="strike-value" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">√âch√©ance</span>
                            <span id="expiry-value" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Volatilit√©</span>
                            <span id="volatility-value" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Taux sans risque</span>
                            <span id="rate-value" class="info-value"></span>
                        </div>
                    </div>
                </div>

                <!-- Risk/Reward Card -->
                <div class="card">
                    <h3>‚öñÔ∏è Risque & Rendement</h3>
                    <div class="risk-reward">
                        <div class="risk-item">
                            <span class="risk-label">Perte Maximale</span>
                            <span id="max-loss" class="risk-value loss">-</span>
                        </div>
                        <div class="risk-item">
                            <span class="risk-label">Profit Maximum</span>
                            <span id="max-profit" class="risk-value profit">Illimit√©</span>
                        </div>
                        <div class="risk-item">
                            <span class="risk-label">Break-Even Inf√©rieur</span>
                            <span id="lower-be" class="risk-value">-</span>
                        </div>
                        <div class="risk-item">
                            <span class="risk-label">Break-Even Sup√©rieur</span>
                            <span id="upper-be" class="risk-value">-</span>
                        </div>
                        <div class="risk-item highlight">
                            <span class="risk-label">Mouvement Requis</span>
                            <span id="required-move" class="risk-value">-</span>
                        </div>
                    </div>
                </div>

                <!-- Greeks Card -->
                <div class="card">
                    <h3>üî¢ Greeks</h3>
                    <div class="greeks-grid">
                        <div class="greek-item">
                            <span class="greek-name">Delta</span>
                            <span id="delta" class="greek-value">-</span>
                            <span class="greek-desc">Sensibilit√© au prix</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-name">Gamma</span>
                            <span id="gamma" class="greek-value positive">-</span>
                            <span class="greek-desc">Acc√©l√©ration</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-name">Vega</span>
                            <span id="vega" class="greek-value positive">-</span>
                            <span class="greek-desc">Sensibilit√© volatilit√©</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-name">Theta</span>
                            <span id="theta" class="greek-value negative">-</span>
                            <span class="greek-desc">D√©croissance temporelle</span>
                        </div>
                        <div class="greek-item">
                            <span class="greek-name">Rho</span>
                            <span id="rho" class="greek-value">-</span>
                            <span class="greek-desc">Sensibilit√© taux</span>
                        </div>
                    </div>
                </div>

                <!-- Chart Card -->
                <div class="card">
                    <h3>üìà Profit & Perte √† l'√©ch√©ance</h3>
                    <div class="chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Advanced Analysis Tab -->
            <div id="advanced-section" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>üî¨ Analyses Avanc√©es</h2>
                    
                    <!-- Volatility Analysis -->
                    <div class="analysis-section">
                        <h3>üìä Analyse de Volatilit√©</h3>
                        <button onclick="loadVolatilityAnalysis()" class="btn-primary">Charger l'analyse</button>
                        <div id="vol-analysis-content" style="display: none;">
                            <div class="chart-container">
                                <canvas id="volHistoryChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="volSensitivityChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Sensitivity Analysis -->
                    <div class="analysis-section">
                        <h3>üéØ Analyse de Sensibilit√© (Greeks)</h3>
                        <button onclick="loadGreeksSensitivity()" class="btn-primary">Charger l'analyse</button>
                        <div id="greeks-analysis-content" style="display: none;">
                            <div class="chart-grid">
                                <div class="chart-container">
                                    <canvas id="spotSensitivityChart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <canvas id="timeSensitivityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Heatmap -->
                    <div class="analysis-section">
                        <h3>üó∫Ô∏è Heatmap de Profit</h3>
                        <button onclick="loadHeatmap()" class="btn-primary">G√©n√©rer Heatmap</button>
                        <div id="heatmap-content" style="display: none;">
                            <div class="chart-container">
                                <canvas id="heatmapChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div id="compare-section" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>‚öñÔ∏è Comparateur de Strat√©gies</h2>
                    <p class="info-text">Comparez diff√©rentes configurations de straddle (√©ch√©ances et strikes)</p>
                    
                    <button onclick="loadComparison()" class="btn-calculate">
                        üîÑ G√©n√©rer la Comparaison
                    </button>
                    
                    <div id="comparison-results" style="display: none;">
                        <div class="table-container">
                            <table class="comparison-table" id="comparisonTable">
                                <thead>
                                    <tr>
                                        <th>√âch√©ance</th>
                                        <th>Strike</th>
                                        <th>Co√ªt Total</th>
                                        <th>Mouvement Requis</th>
                                        <th>Theta (daily)</th>
                                        <th>Vega</th>
                                    </tr>
                                </thead>
                                <tbody id="comparisonBody">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monte Carlo Section -->
            <div id="monte-carlo-section" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>üé≤ Analyse Monte Carlo</h2>
                    <p class="info-text">Simulation de milliers de sc√©narios pour estimer la probabilit√© de profit</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mc-strategy">Strat√©gie</label>
                            <select id="mc-strategy" class="input-field">
                                <option value="straddle">Long Straddle</option>
                                <option value="strangle">Long Strangle</option>
                                <option value="iron_condor">Iron Condor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mc-simulations">Nombre de simulations</label>
                            <input type="number" id="mc-simulations" value="10000" min="1000" max="50000" class="input-field">
                        </div>
                    </div>
                    
                    <button onclick="runMonteCarloAnalysis()" class="btn-calculate">
                        üé≤ Lancer Simulation Monte Carlo
                    </button>
                    
                    <div id="monte-carlo-results" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Backtest Section -->
            <div id="backtest-section" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>üìà Backtesting Historique</h2>
                    <p class="info-text">Testez la strat√©gie sur 1 an de donn√©es historiques r√©elles</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="backtest-strategy">Strat√©gie</label>
                            <select id="backtest-strategy" class="input-field">
                                <option value="straddle">Long Straddle</option>
                                <option value="strangle">Long Strangle</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="backtest-days">P√©riode de d√©tention (jours)</label>
                            <input type="number" id="backtest-days" value="30" min="7" max="90" class="input-field">
                        </div>
                    </div>
                    
                    <button onclick="runBacktest()" class="btn-calculate">
                        üìä Lancer Backtest (1 an)
                    </button>
                    
                    <div id="backtest-results" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Education Section -->
            <div id="education-section" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>üìö Guide √âducatif</h2>
                    
                    <div class="education-grid">
                        <div class="education-card">
                            <h3>üî§ Les Greeks</h3>
                            <div class="greek-item">
                                <strong class="tooltip">Delta (Œî)
                                    <span class="tooltiptext">
                                        <strong>Delta (Œî)</strong>
                                        Mesure la sensibilit√© du prix de l'option √† une variation de 1$ du sous-jacent.
                                        <div class="tooltip-detail">
                                            Range: Call (0 √† 1), Put (-1 √† 0)<br>
                                            Ex: Delta 0.5 ‚Üí +1$ action = +0.50$ option
                                        </div>
                                    </span>
                                </strong>
                                <p>Sensibilit√© au prix du sous-jacent</p>
                            </div>
                            
                            <div class="greek-item">
                                <strong class="tooltip">Gamma (Œì)
                                    <span class="tooltiptext">
                                        <strong>Gamma (Œì)</strong>
                                        Taux de changement du delta. Acc√©l√©ration du prix de l'option.
                                        <div class="tooltip-detail">
                                            Maximum ATM, acc√©l√®re gains et pertes<br>
                                            Ex: Gamma 0.05 ‚Üí Delta change de 0.05 par $1
                                        </div>
                                    </span>
                                </strong>
                                <p>Acc√©l√©ration du delta</p>
                            </div>
                            
                            <div class="greek-item">
                                <strong class="tooltip">Vega (ŒΩ)
                                    <span class="tooltiptext">
                                        <strong>Vega (ŒΩ)</strong>
                                        Sensibilit√© √† une variation de 1% de la volatilit√© implicite.
                                        <div class="tooltip-detail">
                                            Toujours positif pour acheteurs<br>
                                            Ex: Vega 0.15 ‚Üí +1% vol = +0.15$ option
                                        </div>
                                    </span>
                                </strong>
                                <p>Sensibilit√© √† la volatilit√©</p>
                            </div>
                            
                            <div class="greek-item">
                                <strong class="tooltip">Theta (Œò)
                                    <span class="tooltiptext">
                                        <strong>Theta (Œò)</strong>
                                        Perte de valeur temps par jour (time decay).
                                        <div class="tooltip-detail">
                                            N√©gatif pour acheteurs, acc√©l√®re proche expiration<br>
                                            Ex: Theta -0.05 ‚Üí Option perd 5¬¢ par jour
                                        </div>
                                    </span>
                                </strong>
                                <p>√ârosion temporelle (time decay)</p>
                            </div>
                            
                            <div class="greek-item">
                                <strong class="tooltip">Rho (œÅ)
                                    <span class="tooltiptext">
                                        <strong>Rho (œÅ)</strong>
                                        Sensibilit√© √† une variation de 1% des taux d'int√©r√™t.
                                        <div class="tooltip-detail">
                                            Moins important court terme<br>
                                            Positif calls, n√©gatif puts
                                        </div>
                                    </span>
                                </strong>
                                <p>Sensibilit√© aux taux d'int√©r√™t</p>
                            </div>
                        </div>
                        
                        <div class="education-card">
                            <h3>üìä Les Strat√©gies</h3>
                            
                            <div class="strategy-edu">
                                <h4>Long Straddle</h4>
                                <p><strong>Quoi:</strong> Achat call + put ATM (m√™me strike)</p>
                                <p><strong>Quand:</strong> Avant √©v√©nements importants (earnings, FDA)</p>
                                <p><strong>Profit:</strong> Illimit√© si mouvement important</p>
                                <p><strong>Risque:</strong> Limit√© au co√ªt (prime pay√©e)</p>
                            </div>
                            
                            <div class="strategy-edu">
                                <h4>Long Strangle</h4>
                                <p><strong>Quoi:</strong> Achat call OTM + put OTM</p>
                                <p><strong>Quand:</strong> Budget limit√©, fort mouvement attendu</p>
                                <p><strong>Profit:</strong> Illimit√© mais mouvement plus grand requis</p>
                                <p><strong>Risque:</strong> Moins cher qu'un straddle</p>
                            </div>
                            
                            <div class="strategy-edu">
                                <h4>Iron Condor</h4>
                                <p><strong>Quoi:</strong> Bull put spread + Bear call spread</p>
                                <p><strong>Quand:</strong> March√© calme, range-bound</p>
                                <p><strong>Profit:</strong> Limit√© au cr√©dit re√ßu</p>
                                <p><strong>Risque:</strong> Haute probabilit√© mais profit limit√©</p>
                            </div>
                        </div>
                        
                        <div class="education-card">
                            <h3>‚ö†Ô∏è Gestion du Risque</h3>
                            
                            <div class="risk-item">
                                <h4>Value at Risk (VaR)</h4>
                                <p>Perte maximale attendue √† un niveau de confiance donn√© (ex: 95%)</p>
                            </div>
                            
                            <div class="risk-item">
                                <h4>Probabilit√© de Profit</h4>
                                <p>Estimation statistique via Monte Carlo de la chance de gagner</p>
                            </div>
                            
                            <div class="risk-item">
                                <h4>R√®gles de Base</h4>
                                <ul>
                                    <li>Risquer max 2-5% du capital par trade</li>
                                    <li>D√©finir profit target et stop loss</li>
                                    <li>Ne pas tenir jusqu'√† expiration (theta decay)</li>
                                    <li>Attention volatility crush apr√®s √©v√©nements</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multi-Strategy Comparison -->
            <div id="strategy-comparison-section" style="display: none; margin-top: 30px;">
                <div class="card">
                    <h2>‚öñÔ∏è Comparaison Multi-Strat√©gies</h2>
                    <p class="info-text">Comparez Straddle, Strangle et Iron Condor c√¥te √† c√¥te</p>
                    
                    <button onclick="compareStrategies()" class="btn-calculate">
                        üîÑ Comparer les 3 Strat√©gies
                    </button>
                    
                    <div id="strategy-comparison-results" style="margin-top: 20px;"></div>
                    
                    <div class="chart-container" style="margin-top: 30px;">
                        <canvas id="comparison-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Export & Actions -->
            <div id="actions-section" style="display: none;">
                <div class="card actions-card">
                    <h3>üíæ Export & Actions</h3>
                    <div class="actions-grid">
                        <button onclick="exportToPDF()" class="action-btn export-btn">
                            üìï Exporter PDF
                        </button>
                        <button onclick="exportToExcel()" class="action-btn export-btn">
                            üìä Exporter Excel
                        </button>
                        <button onclick="exportToCSV()" class="action-btn export-btn">
                            üìã Exporter CSV
                        </button>
                        <button onclick="exportToJSON()" class="action-btn">
                            üìÑ Exporter JSON
                        </button>
                        <button onclick="printReport()" class="action-btn">
                            üñ®Ô∏è Imprimer
                        </button>
                        <button onclick="shareAnalysis()" class="action-btn">
                            üîó Partager
                        </button>
                        <button onclick="resetAnalysis()" class="action-btn danger">
                            üîÑ Nouvelle Analyse
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Options Pricer ¬© 2025 - Mod√®le Black-Scholes | 
               <a href="https://github.com" target="_blank">GitHub</a> | 
               <a href="#" onclick="showAbout()">√Ä propos</a>
            </p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Chargement des donn√©es...</p>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
